<link rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="../css/responsive.css">
<div id="licenseDisplaySection" class="section hidden animate-[fadeUp_0.6s]"></div>
<script>
  async function loadLicenseDisplay() {
    const spinner = document.getElementById('loadingSpinner');
    spinner.classList.remove('hidden');
    try {
      let templateUrl = selectedState === 'New South Wales' ? 'licence/nsw_driver_licence.html' : 'licence/vic_driver_licence.html';
      const response = await fetch(templateUrl);
      if (!response.ok) throw new Error(`Failed to fetch ${templateUrl}`);
      let templateHtml = await response.text();
      templateHtml = templateHtml.replace('{{fullName}}', licenseDetails.fullName || 'N/A')
                                .replace('{{licenseNumber}}', licenseDetails.licenseNumber || 'N/A')
                                .replace('{{cardNumber}}', licenseDetails.cardNumber || 'N/A')
                                .replace('{{dob}}', formatDate(licenseDetails.dob) || 'N/A')
                                .replace('{{expiryDate}}', formatDate(licenseDetails.expiryDate) || 'N/A')
                                .replace('{{address}}', (licenseDetails.address || '').replace(/\n/g, '<br>') || '12 Main Rd<br>MELBOURNE VIC 3000')
                                .replace('{{image}}', uploadedImage || 'https://via.placeholder.com/120x160');
      document.getElementById('licenseDisplaySection').innerHTML = templateHtml;
      const backButton = document.createElement('button');
      backButton.className = 'back-button w-full py-4 mt-3 rounded-full text-white bg-gray-600 hover:bg-gray-700 font-semibold flex items-center justify-center';
      backButton.innerHTML = '<span class="mr-2">‚Üê</span> Back to Menu';
      backButton.onclick = () => loadPage('license-menu');
      document.getElementById('licenseDisplaySection').appendChild(backButton);
    } catch (error) {
      console.error('Error generating license:', error);
      alert(`Error generating license: ${error.message}. Please try again.`);
      loadPage('license-menu');
    } finally {
      spinner.classList.add('hidden');
    }
  }
  if (licenseDetails && selectedState && uploadedImage) loadLicenseDisplay();
</script>